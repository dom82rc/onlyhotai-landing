import React, { useMemo, useState } from "react";

// Single-file React preview of the ONLYhotAI hub UI (no backend yet)
// Tailwind is available in canvas preview. In a real Next.js app, paste this into app/page.tsx
// and ensure Tailwind is configured. Replace emoji placeholders with RPM <canvas> when wiring Three.js.

const CATEGORIES = [
  { key: "girl", label: "Girl", color: "from-pink-500 to-fuchsia-500", icon: "üë©" },
  { key: "man", label: "Man", color: "from-sky-500 to-blue-600", icon: "üë®" },
  { key: "trans", label: "Trans", color: "from-amber-500 to-violet-600", icon: "üè≥Ô∏è‚Äç‚ößÔ∏è" },
];

const PRESETS: Record<string, { name: string; emoji: string; outfits: string[]; lines: string[] }[]> = {
  girl: [
    {
      name: "Luna",
      emoji: "üßç‚Äç‚ôÄÔ∏è",
      outfits: ["Leather + Visor", "Red Dress", "Neo Kimono"],
      lines: [
        "Hey babe, ready for our next adventure?",
        "I saved a surprise for you tonight‚Ä¶",
      ],
    },
    {
      name: "Sophia",
      emoji: "üíÉ",
      outfits: ["Black Suit", "Blue Evening", "Jeans + Tee"],
      lines: ["You look amazing today‚Ä¶", "Where are we flying next?"],
    },
    {
      name: "Maya",
      emoji: "üèÉ‚Äç‚ôÄÔ∏è",
      outfits: ["Gym Fit", "Hoodie + Leggings", "Racing Suit"],
      lines: ["Let‚Äôs hit the gym together!", "I challenge you to a race‚Ä¶"],
    },
  ],
  man: [
    {
      name: "Ethan",
      emoji: "üßç‚Äç‚ôÇÔ∏è",
      outfits: ["Black Suit", "Chino Beige", "Hoodie + Sneakers"],
      lines: ["How was your day, gorgeous?", "I booked us a weekend getaway."],
    },
    {
      name: "Kai",
      emoji: "üèÑ‚Äç‚ôÇÔ∏è",
      outfits: ["Swim + Shell", "Shorts + Tee", "Hawaiian + Shades"],
      lines: ["Waves are perfect today, wanna join?", "I made you the best mojito‚Ä¶"],
    },
  ],
  trans: [
    {
      name: "Alexis",
      emoji: "üë†",
      outfits: ["Silver Glam", "Black Body + Leather", "Violet Mini"],
      lines: ["You‚Äôre my favorite person here.", "Wanna dance until sunrise?"],
    },
    {
      name: "Riley",
      emoji: "üßç",
      outfits: ["Ripped Jeans + Tee", "Crop + Cargo", "Bomber + Mini Skirt"],
      lines: ["Where should we go tonight?", "I cooked something special for you‚Ä¶"],
    },
  ],
};

function NeonCard({ children, className = "" }: React.PropsWithChildren<{ className?: string }>) {
  return (
    <div
      className={
        "rounded-2xl p-4 md:p-6 bg-white/5 backdrop-blur outline outline-1 outline-white/10 shadow-[0_0_0_2px_rgba(255,255,255,0.03),0_10px_30px_rgba(255,45,138,.2),0_0_60px_rgba(139,92,246,.15)] " +
        className
      }
    >
      {children}
    </div>
  );
}

function Header({ onHome }: { onHome: () => void }) {
  return (
    <header className="max-w-6xl mx-auto px-4 py-5 flex items-center justify-between">
      <button onClick={onHome} className="flex items-center gap-3 group">
        <div className="w-9 h-9 rounded-full grid place-items-center text-sm font-bold bg-gradient-to-tr from-pink-500 to-violet-500">OH</div>
        <div>
          <div className="font-semibold tracking-wide">ONLYhotAI</div>
          <div className="text-xs text-white/60 -mt-0.5">Your AI. Your Fantasy.</div>
        </div>
      </button>
      <nav className="hidden sm:flex items-center gap-6 text-sm text-white/80">
        <span className="inline-flex items-center gap-2"><span className="w-1.5 h-1.5 rounded-full bg-pink-500 animate-pulse"/> Live Preview</span>
        <a href="#waitlist" className="hover:text-white">Waitlist</a>
      </nav>
    </header>
  );
}

export default function App() {
  const [route, setRoute] = useState<{ page: "home" | "category" | "avatar"; cat?: string; idx?: number }>({
    page: "home",
  });

  return (
    <div className="min-h-screen text-white" style={{
      background:
        "radial-gradient(1200px 600px at 20% 10%, rgba(255,45,138,.25), transparent 50%)," +
        "radial-gradient(1200px 600px at 80% 20%, rgba(96,165,250,.25), transparent 50%)," +
        "radial-gradient(900px 500px at 50% 80%, rgba(139,92,246,.20), transparent 60%),#0b0b12",
    }}>
      <Header onHome={() => setRoute({ page: "home" })} />

      {route.page === "home" && <Home onPick={(key) => setRoute({ page: "category", cat: key })} />}
      {route.page === "category" && route.cat && (
        <Category
          cat={route.cat}
          onBack={() => setRoute({ page: "home" })}
          onOpen={(idx) => setRoute({ page: "avatar", cat: route.cat, idx })}
        />
      )}
      {route.page === "avatar" && route.cat && typeof route.idx === "number" && (
        <AvatarView
          cat={route.cat}
          index={route.idx}
          onBack={() => setRoute({ page: "category", cat: route.cat })}
        />
      )}

      <Footer />
    </div>
  );
}

function Home({ onPick }: { onPick: (key: string) => void }) {
  return (
    <main className="max-w-6xl mx-auto px-4 pt-6 pb-16">
      <div className="max-w-2xl">
        <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-tr from-pink-500 to-violet-500">3D AI Companions</span>
        <h1 className="mt-5 text-4xl md:text-6xl font-extrabold tracking-tight">
          Your AI. <span className="text-pink-400">Your Fantasy.</span> Anytime.
        </h1>
        <p className="mt-5 text-white/80 text-lg max-w-prose">
          Choose <em>Girl</em>, <em>Man</em> or <em>Trans</em>. Chat, voice & private rooms with lifelike avatars. Switch outfits. Build your vibe.
        </p>
      </div>

      <div className="mt-10 grid sm:grid-cols-3 gap-5">
        {CATEGORIES.map((c) => (
          <button
            key={c.key}
            onClick={() => onPick(c.key)}
            className={`group relative rounded-2xl border border-white/10 p-6 text-left bg-white/5 hover:bg-white/10 transition`}
          >
            <div className={`absolute -inset-0.5 rounded-2xl opacity-40 blur-2xl -z-10 bg-gradient-to-tr ${c.color}`}></div>
            <div className="text-4xl">{c.icon}</div>
            <div className="mt-4 text-xl font-semibold">{c.label}</div>
            <div className="mt-2 text-white/70 text-sm">3‚Äì5 avatars ‚Ä¢ outfits ‚Ä¢ voice</div>
          </button>
        ))}
      </div>
    </main>
  );
}

function Category({ cat, onBack, onOpen }: { cat: string; onBack: () => void; onOpen: (idx: number) => void }) {
  const list = PRESETS[cat] || [];
  const catMeta = CATEGORIES.find((c) => c.key === cat)!;
  return (
    <main className="max-w-6xl mx-auto px-4 pt-4 pb-16">
      <div className="flex items-center justify-between">
        <button onClick={onBack} className="text-white/70 hover:text-white">‚Üê Back</button>
        <h2 className="font-semibold text-lg">{catMeta.label} Avatars</h2>
        <span className="text-white/50 text-sm">Early Access</span>
      </div>

      <div className="mt-6 grid md:grid-cols-3 gap-5">
        {list.map((a, i) => (
          <NeonCard key={i}>
            <div className="flex items-start gap-4">
              <div className="text-6xl">{a.emoji}</div>
              <div className="grow">
                <div className="font-semibold">{a.name}</div>
                <div className="text-xs text-white/60">{catMeta.label}</div>
                <div className="mt-2 flex flex-wrap gap-2 text-xs">
                  {a.outfits.map((o, j) => (
                    <span key={j} className="px-2 py-1 rounded bg-white/10">{o}</span>
                  ))}
                </div>
                <button
                  onClick={() => onOpen(i)}
                  className="mt-4 rounded-lg px-4 py-2 bg-gradient-to-tr from-pink-500 to-violet-500 font-semibold"
                >
                  Chat now
                </button>
              </div>
            </div>
          </NeonCard>
        ))}
      </div>
    </main>
  );
}

function AvatarView({ cat, index, onBack }: { cat: string; index: number; onBack: () => void }) {
  const avatar = PRESETS[cat][index];
  const [outfit, setOutfit] = useState(0);
  const [messages, setMessages] = useState<{ role: "ai" | "me"; text: string }[]>([
    { role: "ai", text: avatar.lines[0] },
  ]);

  function send(msg: string) {
    if (!msg.trim()) return;
    setMessages((m) => [...m, { role: "me", text: msg }]);
    // Simulated AI reply
    const reply = avatar.lines[(messages.length / 2) % avatar.lines.length | 0] || avatar.lines[0];
    setTimeout(() => setMessages((m) => [...m, { role: "ai", text: reply }]), 600);
  }

  return (
    <main className="max-w-6xl mx-auto px-4 pt-4 pb-20">
      <div className="flex items-center justify-between">
        <button onClick={onBack} className="text-white/70 hover:text-white">‚Üê {avatar.name}</button>
        <h2 className="font-semibold text-lg">Live Preview</h2>
        <button className="rounded-lg px-3 py-1.5 text-xs bg-white/10 hover:bg-white/15">Upgrade</button>
      </div>

      <div className="mt-5 grid md:grid-cols-2 gap-6 items-stretch">
        <NeonCard>
          <div className="text-sm text-white/60 flex items-center justify-between">
            <span>3D Avatar (placeholder)</span>
            <span>Outfit: {avatar.outfits[outfit]}</span>
          </div>
          <div className="mt-4 grid place-items-center aspect-[4/5] rounded-xl bg-black/30">
            <div className="text-center">
              <div className="text-7xl">{avatar.emoji}</div>
              <div className="text-white/60 mt-1">Rotate ‚Ä¢ Zoom ‚Ä¢ Speak</div>
            </div>
          </div>
          <div className="mt-3 flex gap-2 flex-wrap">
            {avatar.outfits.map((o, i) => (
              <button
                key={i}
                onClick={() => setOutfit(i)}
                className={`px-3 py-2 rounded-lg text-sm ${
                  i === outfit ? "bg-gradient-to-tr from-pink-500 to-violet-500" : "bg-white/10 hover:bg-white/15"
                }`}
              >
                {o}
              </button>
            ))}
          </div>
        </NeonCard>

        <NeonCard>
          <div className="text-sm text-white/60">Chat</div>
          <div className="mt-3 h-80 overflow-auto space-y-2 pr-1">
            {messages.map((m, i) => (
              <div key={i} className={`max-w-[85%] px-3 py-2 rounded-xl text-sm ${m.role === "ai" ? "bg-white/10" : "bg-gradient-to-tr from-pink-500 to-violet-500 ml-auto"}`}>
                {m.text}
              </div>
            ))}
          </div>
          <ChatInput onSend={send} placeholder={`Message ${avatar.name}‚Ä¶`} />
          <div className="mt-3 text-xs text-white/60">Voice & lip‚Äësync will play here. (Coqui/Piper + visemes)</div>
        </NeonCard>
      </div>
    </main>
  );
}

function ChatInput({ onSend, placeholder }: { onSend: (text: string) => void; placeholder: string }) {
  const [val, setVal] = useState("");
  return (
    <form
      className="mt-3 flex gap-2"
      onSubmit={(e) => {
        e.preventDefault();
        onSend(val);
        setVal("");
      }}
    >
      <input
        value={val}
        onChange={(e) => setVal(e.target.value)}
        placeholder={placeholder}
        className="w-full bg-transparent border border-white/10 focus:border-pink-400/70 outline-none rounded-xl px-4 py-3 placeholder-white/40"
      />
      <button className="rounded-xl px-4 py-3 font-semibold bg-gradient-to-tr from-pink-500 to-violet-500">Send</button>
    </form>
  );
}

function Footer() {
  const year = new Date().getFullYear();
  return (
    <footer className="max-w-6xl mx-auto px-4 pb-10 text-xs text-white/60">
      <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div className="space-y-1">
          <div>¬© {year} ONLYhotAI</div>
          <div className="flex items-center gap-3">
            <a href="#" className="hover:text-white">Privacy</a>
            <span aria-hidden>‚Ä¢</span>
            <a href="#" className="hover:text-white">Terms</a>
            <span aria-hidden>‚Ä¢</span>
            <a href="https://onlyloveme.com" target="_blank" rel="noreferrer" className="hover:text-white">Also: OnlyLoveMe.com</a>
          </div>
        </div>
        <div className="text-white/70">Early access ‚Ä¢ Europe/Rome</div>
      </div>
    </footer>
  );
}
